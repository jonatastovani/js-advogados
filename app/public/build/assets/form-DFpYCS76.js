var E=Object.defineProperty;var w=i=>{throw TypeError(i)};var T=(i,e,a)=>e in i?E(i,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):i[e]=a;var P=(i,e,a)=>T(i,typeof e!="symbol"?e+"":e,a),b=(i,e,a)=>e.has(i)||w("Cannot "+a);var f=(i,e,a)=>(b(i,e,"read from private field"),a?a.call(i):e.get(i)),m=(i,e,a)=>e.has(i)?w("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(i):e.set(i,a),d=(i,e,a,t)=>(b(i,e,"write to private field"),t?t.call(i,a):e.set(i,a),a),p=(i,e,a)=>(b(i,e,"access private method"),a);import{e as v,c,a as N}from"./commonFunctions-iccisCSl.js";import{R as x}from"./RedirectHelper-MLdxMTBD.js";import{S as A,R as I}from"./ServicoParticipacaoModule-Bhhk-2vT.js";import{U as O,a as F}from"./UUIDHelper-C7Qwh3zO.js";import"./modalMessage-CWFhqvtB.js";import"./modalSearchAndFormRegistration-3_gFT7xi.js";var l,g,u,r,R,C,_,j,y,D;class H{constructor(){m(this,r);P(this,"_objConfigs",{url:{base:window.apiRoutes.baseParticipacaoPreset,baseParticipacaoTipo:window.apiRoutes.baseServicoParticipacaoTipoTenant},sufixo:"PageServicoParticipacaoPresetForm",data:{porcentagemOcupada:0,participantesNaTela:[]}});m(this,l);m(this,g);m(this,u);this.initEvents();const e={objConfigs:this._objConfigs};d(this,u,new A(this,e))}initEvents(){var t,o;const e=this,a=O.getURLSegment();F.isValidUUID(a)?(d(e,g,a),d(this,l,v.PUT),p(t=e,r,y).call(t)):(d(this,l,v.POST),$(`#nome${e._objConfigs.sufixo}`).trigger("focus")),p(o=e,r,R).call(o)}}l=new WeakMap,g=new WeakMap,u=new WeakMap,r=new WeakSet,R=function(){const e=this;$(`#btnSave${e._objConfigs.sufixo}`).on("click",async function(a){var t;a.preventDefault(),p(t=e,r,C).call(t)})},C=function(){var o,s;const e=this,a=$(`#form${e._objConfigs.sufixo}`);let t=c.getInputsValues(a[0]);return t.participantes=e._objConfigs.data.participantesNaTela,p(o=e,r,_).call(o,t,a)&&p(s=e,r,j).call(s,t,e._objConfigs.url.base),!1},_=function(e,a){const t=this;let o=c.verificationData(e.nome,{field:a.find('input[name="nome"]'),messageInvalid:"O <b>nome</b> do preset deve ser informado.",setFocus:!0}),s=t._objConfigs.data.porcentagem_ocupada;if((s>0&&s<100||s>100)&&(c.generateNotification(`As somas das porcentagens deve ser igual a 100%. Porcentagem informada ${c.formatWithCurrencyCommasOrFraction(s)}%.`,"warning"),o=!1),!e.participantes||e.participantes.length==0)c.generateNotification("E necessário informar pelo menos um participante.","warning"),o=!1;else for(const n of e.participantes)if(n.participacao_registro_tipo_id==window.Enums.ParticipacaoRegistroTipoEnum.GRUPO&&(!n.integrantes||n.integrantes.length==0)){c.generateNotification("E necessário informar pelo menos um integrante no grupo.","warning"),o=!1;break}return o},j=async function(e,a,t={}){const o=this,{btnSave:s=$(`#btnSave${o._objConfigs.sufixo}`)}=t;try{c.simulateLoading(s);const n=new N(a);n.setAction(f(o,l)),n.setData(e),f(o,l)===v.PUT&&n.setParam(f(o,g)),await n.envRequest()&&x.redirectWithUUIDMessage(window.frontRoutes.frontRedirect,"Dados enviados com sucesso!","success")}catch(n){c.generateNotificationErrorCatch(n)}finally{c.simulateLoading(s,!1)}},y=async function(){var a;const e=this;try{await c.loadingModalDisplay();const t=await p(a=e,r,D).call(a),o=$(`#form${e._objConfigs.sufixo}`);if(t!=null&&t.data){const s=t.data;o.find('input[name="nome"]').val(s.nome).trigger("focus"),o.find('input[name="descricao"]').val(s.descricao),await Promise.all(s.participantes.map(async n=>{const h=n.integrantes??[];delete n.integrantes;const S=await f(e,u)._inserirParticipanteNaTela(n);await Promise.all(h.map(async U=>{await f(e,u)._inserirIntegrante(S,U)}))}))}else o.find("input, textarea, select, button").prop("disabled",!0)}catch(t){c.generateNotificationErrorCatch(t)}finally{await c.loadingModalDisplay(!1)}},D=async function(e={}){const a=this,{idRegister:t=f(a,g),urlApi:o=a._objConfigs.url.base}=e;try{return I.getRecurse({urlApi:o,idRegister:t})}catch(s){return c.generateNotificationErrorCatch(s),!1}};$(function(){new H});
