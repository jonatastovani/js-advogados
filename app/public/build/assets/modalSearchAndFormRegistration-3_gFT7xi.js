var Q=Object.defineProperty;var w=d=>{throw TypeError(d)};var k=(d,c,e)=>c in d?Q(d,c,{enumerable:!0,configurable:!0,writable:!0,value:e}):d[c]=e;var b=(d,c,e)=>k(d,typeof c!="symbol"?c+"":c,e),U=(d,c,e)=>c.has(d)||w("Cannot "+e);var C=(d,c,e)=>c.has(d)?w("Cannot add the same private member more than once"):c instanceof WeakSet?c.add(d):c.set(d,e);var g=(d,c,e)=>(U(d,c,"access private method"),e);import{m as j,e as m,a as h,c as l}from"./commonFunctions-iccisCSl.js";import{m as B}from"./modalMessage-CWFhqvtB.js";import{a as E,U as V}from"./UUIDHelper-C7Qwh3zO.js";var R,I;class G extends j{constructor(e){let n={register:void 0};e.promisseReturnValue=Object.assign(n,e.promisseReturnValue??{});let t={idRegister:void 0};e.dataEnvModal=Object.assign(t,e.dataEnvModal??{});let a={url:{base:void 0}};e.objConfigs=Object.assign(a,e.objConfigs??{});super(e);C(this,R);b(this,"_action");g(this,R,I).call(this)}_modalReset(){const e=this;e._clearForm();const n=$(e.getIdModal).find(".modal-title").data("title-default");n&&e._updateModalTitle(n)}_clearForm(){const e=this,t=$(e.getIdModal).find(".formRegistration");e._action=m.POST,t.find("select").val(0),t[0].reset(),t.find("input, select, textarea").removeClass("is-valid").removeClass("is-invalid")}async _getRecurse(e={}){const n=this,{idRegister:t=n._dataEnvModal.idRegister,urlApi:a=n._objConfigs.url.base}=e;try{const i=new h(a);return i.setParam(t),await i.getRequest()}catch(i){return l.generateNotificationErrorCatch(i),!1}}async _save(e,n,t={}){const a=this,i=$(a.getIdModal),{btnSave:s=i.find(".btn-save"),fieldRegisterName:r="register"}=t;try{l.simulateLoading(s);const o=new h(n);o.setAction(a._action),o.setData(e),a._dataEnvModal.idRegister?(o.setParam(a._dataEnvModal.idRegister),o.setAction(m.PUT)):o.setAction(m.POST);const f=await o.envRequest();f&&(l.generateNotification("Dados enviados com sucesso!","success"),a._promisseReturnValue.refresh=!0,a._promisseReturnValue[r]=f.data,a._endTimer=!0)}catch(o){l.generateNotificationErrorCatch(o)}finally{l.simulateLoading(s,!1)}}}R=new WeakSet,I=function(){};var u,A,F,x,y,O,T;class J extends j{constructor(e){let n={formRegister:!0,runningSearchBln:!1,typeCurrentSearch:void 0},t={selecteds:[]};e.objConfigs=Object.assign(n,e.objConfigs??{}),e.promisseReturnValue=Object.assign(t,e.promisseReturnValue??{});super(e);C(this,u);b(this,"_action");b(this,"_idRegister");b(this,"_btnNewRegister",".btn-new-register");g(this,u,A).call(this)}set _setTypeCurrentSearch(e){this._objConfigs.typeCurrentSearch=e}_actionsHideShowRegistrationFields(e=!1){const n=this,t=$(n.getIdModal);e?(t.find(".divBtnAdd").slideUp(),t.find(".divRegistrationFields").slideDown()):(t.find(".divBtnAdd").slideDown(),t.find(".divRegistrationFields").slideUp())}modalCancel(){const e=this;e._clearForm(),e._actionsHideShowRegistrationFields(),e._executeFocusElementOnModal($(e.getIdModal).find(".formDataSearch").find('input[name="texto"]'))}_modalReset(){const e=this;e._clearForm(),$(e.getIdModal).find(".formDataSearch")[0].reset(),e._actionsHideShowRegistrationFields()}_clearForm(){const e=this,t=$(e.getIdModal).find(".formRegistration");t.length>0&&(e._idRegister=void 0,e._action=m.POST,t.find("select").val(0),t[0].reset(),t.find("input, select, textarea").removeClass("is-valid").removeClass("is-invalid"))}async _generateQueryFilters(e={}){const n=this,{formDataSearch:t=$(e.formDataSearch??$(n.getIdModal).find(".formDataSearch"))}=e,a=t.find('input[name="texto"]').val();let i=[],s={texto:a,parametros_like:n._returnQueryParameters(t.find('select[name="selFormaBusca"]').val()),ordenacao:[{campo:t.find('select[name="selCampoOrdenacao"]').val()??"nome",direcao:t.find('input[name="direcaoConsulta"]:checked').val()}],texto_tratamento:{tratamento:t.find('select[name="selTratamentoTexto"]').val()},filtros:{campos_busca:[]},page:1};const r=l.getInputsValues(t.find(".searchFields"));if(Object.keys(r).forEach(o=>{r[o]===!0&&s.filtros.campos_busca.push(o)}),i.length>0)return l.generateNotification("Não foi possivel realizar a busca. Verifique as seguintes recomendações:","info",{itemsArray:i});e.appendData&&Object.assign(s,e.appendData),await n._getData(s)}_returnQueryParameters(e){switch(e){case"iniciado_por":return{curinga_inicio_bln:!1,curinga_final_bln:!0};case"terminado_por":return{curinga_inicio_bln:!0,curinga_final_bln:!1};case"qualquer_incidencia":return{curinga_inicio_bln:!0,curinga_final_bln:!0};default:return{curinga_inicio_bln:!1,curinga_final_bln:!1}}}async _getData(e,n=1){var f,P;const t=this;if(t._objConfigs.runningSearchBln){l.generateNotification("Busca em andamento. Aguarde...","info");return}let a=g(f=t,u,y).call(f);if(!a)return;const i=$(t.getIdModal),s=i.find(a.btnSearch??".btnBuscar"),r=i.find(a.tbody??".tableData tbody"),o=i.find(a.footerPagination??".footerPagination");t._objConfigs.runningSearchBln=!0;try{l.simulateLoading(s),t._paginationDefault({footerPagination:o}),r.html(""),t._refreshQueryQuantity("Consultando...",{footerPagination:o}),t._refreshQueryStatus("Efetuando busca. Aguarde...",{footerPagination:o});const _=await new h(a.urlSearch);e.page=n,_.setAction(m.POST),_.setData(e);const S=await _.envRequest();if(t._refreshQueryStatus("Busca concluída. Preenchendo os dados...",{footerPagination:o}),S.data){const v=S.data;let D=[];for(let p of v.data){const N=E.generateUUID();p=Object.assign(p,{idTr:N});const q=a.insertTableData?a.insertTableData:"insertTableData",M=await t[q](p,{config:a,tbody:r});D.push(typeof M=="object"?M:p)}t._refreshQueryQuantity(v.total,{footerPagination:o}),g(P=t,u,O).call(P,v,{footerPagination:o,dataPost:e}),a.dataPost=e,a.recordsOnScreen=D}else t._refreshQueryQuantity(0,{footerPagination:o}),t._paginationDefault({footerPagination:o}),a.dataPost=e,a.recordsOnScreen=[]}catch(_){l.generateNotificationErrorCatch(_),o.find(".totalRegistros").html(0)}finally{l.simulateLoading(s,!1),t._refreshQueryStatus("Aguardando comando do usuário...",{footerPagination:o}),t._objConfigs.runningSearchBln=!1}}_paginationDefault(e={}){const n=this,{footerPagination:t=$(e.footerPagination??$(n.getIdModal).find(".footerPagination")),pagination:a=$(e.pagination??$(t).find(".pagination"))}=e;a.html(`
            <li class="page-item disabled">
                <button type="button" class="page-link" aria-label="Anterior">
                    <span aria-hidden="true">&laquo; Anterior</span>
                </button>
            </li>
            <li class="page-item disabled">
                <button type="button" class="page-link" aria-label="Próximo">
                    <span aria-hidden="true">Pr&oacute;xima &raquo;</span>
                </button>
            </li>
        `)}_refreshQueryStatus(e,n={}){const t=this,{footerPagination:a=$(n.footerPagination??$(t.getIdModal).find(".footerPagination")),selector:i=n.selector??a.find(".queryStatus")}=n;i&&i.html(e)}_refreshQueryQuantity(e,n={}){const t=this,{footerPagination:a=$(n.footerPagination??$(t.getIdModal).find(".footerPagination")),selector:i=n.selector??a.find(".totalRegisters")}=n;$(i).html(e)}async _getRecurse(e={}){var i;const n=this,{idRegister:t=n._idRegister}=e;let a=g(i=n,u,y).call(i);if(a)try{const s=new h(a.url);return s.setParam(t),await s.getRequest()}catch(s){return l.generateNotificationErrorCatch(s),!1}}async _save(e,n,t={}){const a=this,i=$(a.getIdModal),{btnSave:s=i.find(".btn-save")}=t;try{l.simulateLoading(s);const r=new h(n);r.setAction(a._action),r.setData(e),a._action===m.PUT&&r.setParam(a._idRegister),await r.envRequest()&&(l.generateNotification("Dados enviados com sucesso!","success"),a._promisseReturnValue.refresh=!0,a._generateQueryFilters(),a._action===m.PUT?a.modalCancel():(a._clearForm(),a._executeFocusElementOnModal($(a.getIdModal).find(".formDataSearch").find(".focusRegister"))))}catch(r){l.generateNotificationErrorCatch(r)}finally{l.simulateLoading(s,!1)}}async _delButtonAction(e,n,t={}){const a=this,{button:i=null,title:s="Exclusão de Registro",message:r=`Confirma a exclusão do registro <b>${n}</b>?`,success:o="Registro excluído com sucesso!"}=t;try{const f=new B;f.setDataEnvModal={title:s,message:r},f.setFocusElementWhenClosingModal=i,await a._modalHideShow(!1),await f.modalOpen()&&await a._delRecurse(e,t)&&(l.generateNotification(o,"success"),a.modalCancel(),a._generateQueryFilters())}catch(f){l.generateNotificationErrorCatch(f)}finally{await a._modalHideShow(!0)}}async _delRecurse(e,n={}){var i;let a=g(i=this,u,y).call(i);if(a)try{const s=new h(a.url);s.setParam(e);const r=await s.deleteRequest();return!0}catch(s){return l.generateNotificationErrorCatch(s),!1}}_updateTitleRegistration(e,n={}){const t=this,{formRegistration:a=$(t.getIdModal).find(".formRegistration"),title:i=$(n.title??$(t.getIdModal).find(".registration-title"))}=n;i.html(e)}}u=new WeakSet,A=function(){const e=this;$(e.getIdModal),g(this,u,F).call(this),g(this,u,x).call(this)},F=function(){const e=this;$(e.getIdModal).find(this._btnNewRegister).on("click",()=>{e._action=m.POST,e._actionsHideShowRegistrationFields(!0),e._executeFocusElementOnModal($(e.getIdModal).find(".focusRegister"))})},x=function(){const e=this;if(e._objConfigs.modalSearch){const n=e._objConfigs.modalSearch.inputsSearchs??null;if(n){const t=e._objConfigs.modalSearch.event??"input";n.on(t,function(){clearTimeout(e._timerSearch),e._timerSearch=setTimeout(function(){e.generateFilters()},1e3)})}}},y=function(){const e=this;for(const n of Object.values(e._objConfigs.querys))if(n.name==e._objConfigs.typeCurrentSearch)return n;return l.generateNotification("O tipo de busca informado não foi encontrado.","error"),!1},O=async function(e,n){var s;const t=this,{footerPagination:a=$(n.footerPagination??$(t.getIdModal).find(".footerPagination")),selector:i=$(n.pagination??$(a).find(".pagination"))}=n;i.html("");for(const r of e.links){let o="";const f=E.generateUUID();switch(r.label){case"&laquo; Previous":o=`
                    <li class="page-item ${r.url?"":"disabled"}">
                        <button id="${f}" type="button" class="page-link" aria-label="Anterior">
                            <span aria-hidden="true">&laquo; Anterior</span>
                        </button>
                    </li>`;break;case"Next &raquo;":o=`
                    <li class="page-item ${r.url?"":"disabled"}">
                        <button id="${f}" type="button" class="page-link" aria-label="Próximo">
                            <span aria-hidden="true">Pr&oacute;xima &raquo;</span>
                        </button>
                    </li>`;break;case"...":o=`
                    <li class="page-item disabled">
                        <button id="${f}" type="button" class="page-link">${r.label}</button>
                    </li>`;break;default:e.total&&(o=`
                    <li class="page-item ${r.active?"active":""}">
                        <button id="${f}" type="button" class="page-link">${r.label}</button>
                    </li>`);break}i.append(o),g(s=t,u,T).call(s,f,r,n)}},T=function(e,n,t){const a=this,{dataPost:i=t.dataPost}=t;if(n.url){const s=V.getParameterURL("page",n.url);if(s){const r=a._objConfigs.typeCurrentSearch;$(`#${e}`).on("click",function(){a._objConfigs.typeCurrentSearch=r,a._getData(i,s)})}}};export{J as a,G as m};
