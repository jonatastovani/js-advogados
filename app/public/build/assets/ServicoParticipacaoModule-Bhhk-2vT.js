var ke=Object.defineProperty;var te=u=>{throw TypeError(u)};var Ve=(u,t,e)=>t in u?ke(u,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):u[t]=e;var M=(u,t,e)=>Ve(u,typeof t!="symbol"?t+"":t,e),oe=(u,t,e)=>t.has(u)||te("Cannot "+e);var E=(u,t,e)=>(oe(u,t,"read from private field"),e?e.call(u):t.get(u)),v=(u,t,e)=>t.has(u)?te("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(u):t.set(u,e);var f=(u,t,e)=>(oe(u,t,"access private method"),e);import{e as W,a as Q,c as n,m as Ae}from"./commonFunctions-iccisCSl.js";import{m as K}from"./modalMessage-CWFhqvtB.js";import{m as ce,a as le}from"./modalSearchAndFormRegistration-3_gFT7xi.js";import{a as j}from"./UUIDHelper-C7Qwh3zO.js";class ie{static async get(t={}){const{urlApi:e}=t;return await new Q(e).getRequest()}static async getRecurse(t={}){const{idRegister:e,urlApi:a}=t,o=new Q(a);return o.setParam(e),await o.getRequest()}static async delRecurse(t={}){const{idRegister:e,urlApi:a}=t,o=new Q(a);return o.setParam(e),o.setAction(W.DELETE),await o.deleteRequest()}}var D,F,k,R,de,fe,pe,ue;class re extends ce{constructor(e){super({idModal:"#modalNome"});v(this,R);v(this,D,{title:void 0,mensagem:void 0,nome:void 0});v(this,F,{sufixo:"ModalNome"});v(this,k,{refresh:!1});this._objConfigs=Object.assign(this._objConfigs,E(this,F)),this._promisseReturnValue=Object.assign(this._promisseReturnValue,E(this,k)),this._dataEnvModal=Object.assign(this._dataEnvModal,E(this,D)),this._objConfigs.url.base=e,this._action=W.POST,f(this,R,de).call(this)}async modalOpen(){var o;const e=this;let a=!0;if(e._dataEnvModal.title||(a=!1,n.generateNotification("Título não informado.","error")),e._dataEnvModal.mensagem||(a=!1,n.generateNotification("Mensagem não informada.","error")),a)await f(o=e,R,pe).call(o);else return await e._returnPromisseResolve();return await e._modalHideShow(),await e._modalOpen()}saveButtonAction(){var i;const e=this,a=$(e.getIdModal).find(".formRegistration"),o=n.getInputsValues(a[0]);f(i=e,R,ue).call(i,o)&&(e._promisseReturnValue.name=o.nome,e._promisseReturnValue.refresh=!0,e._endTimer=!0)}}D=new WeakMap,F=new WeakMap,k=new WeakMap,R=new WeakSet,de=function(){f(this,R,fe).call(this)},fe=function(){},pe=async function(){const e=this,a=$(e.getIdModal).find('input[name="nome"]');e._updateModalTitle(e._dataEnvModal.title),$(e.getIdModal).find(".lblMensagem").text(e._dataEnvModal.mensagem),e._dataEnvModal.nome&&a.val(e._dataEnvModal.nome),e._executeFocusElementOnModal(a)},ue=function(e){const a=this,o=$(a.getIdModal).find(".formRegistration");return n.verificationData(e.nome,{field:o.find('input[name="nome"]'),messageInvalid:"O Nome deve ser informado.",setFocus:!0})};var V,me;class qe{constructor(t,e){v(this,V);M(this,"parentId");M(this,"parentInstance");this.parentInstance=t,this.parentId=e,f(this,V,me).call(this)}async generateQueryFiltersCriteria(){const t=this,e=$(t.parentId);let a=[],o={criterios:[],ordenacao:[{campo:"nome",direcao:"asc"}],page:1};const r=e.find(".containerCriterios").find(".colCriterio");for(let s=0;s<r.length;s++){const d=$(r[s]);if(d.find(".ckbCriterio").is(":checked")){const c=n.getInputsValues(d),p=c.texto;p==""?a.push(`O critério do campo <b>${c.nomeCriterio}</b> deve ser preenchido.`):o.criterios.push({campo:c.campo,texto:p,texto_tratamento:{tratamento:c.tratamento},parametros_like:this.parentInstance._returnQueryParameters(c.formaBusca)})}}return o.criterios.length||a.push("Utilize pelo menos um critério de busca."),a.length>0?(n.generateNotification("Não foi possivel realizar a busca. Verifique as seguintes recomendações:","info",{itemsArray:a}),!1):o}}V=new WeakSet,me=function(){const t=this,e=$(t.parentId),a=e.find(".containerCriterios").find(".colCriterio"),o={valor_atribuido:!1,select_tratamento_valor_padrao:"",select_forma_busca_padrao:""};for(let i=0;i<a.length;i++){const r=$(a[i]),s=r.find(".ckbCriterio"),d=r.find(".campoCriterio");s.on("change",function(){s.is(":checked")?d.attr("disabled",!1):d.attr("disabled",!0)}),o.valor_atribuido||(o.select_tratamento_valor_padrao=r.find(".selectTratamentoCriterio").val(),o.select_forma_busca_padrao=r.find(".selectFormaBuscaCriterio").val(),o.valor_atribuido=!0)}e.find(".btnDesmarcarCriterios").on("click",function(){for(let i=0;i<a.length;i++)$(a[i]).find(".ckbCriterio").prop("checked",!1).trigger("change")}),e.find(".btnLimparCriterios").on("click",function(){for(let i=0;i<a.length;i++){const r=$(a[i]);r.find(".ckbCriterio").prop("checked",!1).trigger("change"),r.find(".textoCriterio").val(""),r.find(".selectTratamentoCriterio").val(o.select_tratamento_valor_padrao),r.find(".selectFormaBuscaCriterio").val(o.select_forma_busca_padrao)}})};var A,x,ge,be,_e,he;class Be extends Ae{constructor(){super({idModal:"#modalSelecionarPerfil",objConfigs:{modalConfig:{modalCloseOnEscape:!1,modalCloseOnClickBackdrop:!1}}});v(this,x);v(this,A,{perfis_opcoes:[]});this._dataEnvModal=Object.assign(this._dataEnvModal,E(this,A))}async modalOpen(){var a;const e=this;return await f(a=e,x,be).call(a)?(await e._modalHideShow(),await e._modalOpen()):e._returnPromisseResolve()}saveButtonAction(){var i;const e=this,a=$(e.getIdModal).find(".formRegistration");let o=n.getInputsValues(a[0]);f(i=e,x,ge).call(i,o,a)&&e._save(o,e._objConfigs.url.base)}}A=new WeakMap,x=new WeakSet,ge=function(e,a){let o=n.verificationData(e.titulo,{field:a.find('input[name="titulo"]'),messageInvalid:"O título deve ser informado.",setFocus:!0});return o=n.verificationData(e.descricao,{field:a.find('textarea[name="descricao"]'),messageInvalid:"Uma descrição deve ser adicionada.",setFocus:o==!0,returnForcedFalse:o==!1}),o},be=async function(){var a,o;const e=this;$(e.getIdModal).find(".rowButtons").html("");try{for(const i of e._dataEnvModal.perfis_opcoes){const r=window.Details.PessoaPerfilTipoEnum.find(s=>s.id==i.perfil_tipo_id);if(!r)return console.error("Tipo de perfil inexistente.",i),n.generateNotification("Tipo de perfil inexistente.","error"),!1;i.idButton=await f(a=e,x,_e).call(a,r),f(o=e,x,he).call(o,i)}return!0}catch(i){return n.generateNotificationErrorCatch(i),!1}},_e=async function(e){const a=this,o=$(a.getIdModal).find(".rowButtons"),i=j.generateUUID(),r=`
            <div id="${i}" class="col">
                <button type="button" class="btn btn-dark w-100 border-0">
                    <h5 class="card-title">${e.nome}</h5>
                    <p class="card-text">${e.descricao}</p>
                </button>
            </div>`;return o.append(r),i},he=async function(e){const a=this;$(a.getIdModal).find(`#${e.idButton}`).on("click",async function(){delete e.idButton,a._promisseReturnValue.register=e,a._promisseReturnValue.refresh=!0,a._endTimer=!0})};var q,B,h,ve,X,we,Y,I,O;class se extends le{constructor(e={}){const a={idModal:"#modalPessoa"};e.dataEnvModal&&(a.dataEnvModal=e.dataEnvModal);super(a);v(this,h);v(this,q,{formRegister:!1,querys:{consultaFiltrosFisica:{name:"consulta-filtros-fisica",url:window.apiRoutes.basePessoas,urlSearch:`${window.apiRoutes.basePessoas}/consulta-filtros/pessoa-fisica`,tbody:$("#tableDataModalPessoaFisica").find("tbody"),footerPagination:$("#footerPaginationModalPessoaFisica"),formDataSearch:$("#formDataSearchModalPessoaFisica"),insertTableData:"insertTableDataPessoaFisica"},consultaFiltrosJuridica:{name:"consulta-filtros-juridica",url:window.apiRoutes.basePessoas,urlSearch:`${window.apiRoutes.basePessoas}/consulta-filtros/pessoa-juridica`,tbody:$("#tableDataModalPessoaJuridica").find("tbody"),footerPagination:$("#footerPaginationModalPessoaJuridica"),formDataSearch:$("#formDataSearchModalPessoaJuridica")},consultaFisicaCriterios:{name:"consulta-criterios",url:window.apiRoutes.basePessoas,urlSearch:`${window.apiRoutes.basePessoas}/consulta-criterios/pessoa-fisica`,tbody:$("#tableDataModalPessoaFisicaCriterios").find("tbody"),footerPagination:$("#footerPaginationModalPessoaFisicaCriterios"),formDataSearch:$("#formDataSearchModalPessoaFisicaCriterios")},consultaJuridicaCriterios:{name:"consulta-criterios",url:window.apiRoutes.basePessoas,urlSearch:`${window.apiRoutes.basePessoas}/consulta-criterios/pessoa-juridica`,tbody:$("#tableDataModalPessoaJuridicaCriterios").find("tbody"),footerPagination:$("#footerPaginationModalPessoaJuridicaCriterios"),formDataSearch:$("#formDataSearchModalPessoaJuridicaCriterios")}},sufixo:"ModalPessoa"});v(this,B,{attributes:{select:{quantity:1,autoReturn:!0}}});this._objConfigs=Object.assign(this._objConfigs,E(this,q)),this._dataEnvModal=Object.assign(this._dataEnvModal,E(this,B)),this.functionsCriteria=new qe(this,this._idModal)}async modalOpen(){var a,o;const e=this;return f(a=e,h,ve).call(a),f(o=e,h,O).call(o),await e._modalHideShow(),await e._modalOpen()}_modalClose(){const e=this,a=$(e.getIdModal);a.find("#consultaPessoas-tab").trigger("click"),a.find(`#formDataSearch${e._objConfigs.sufixo}Criterios`).length&&a.find(".btnLimparCriterios").trigger("click"),super._modalClose()}_modalReset(){const e=this,a=$(e.getIdModal);super._modalReset(),a.find("tbody").html(""),e._paginationDefault()}async insertTableDataPessoaFisica(e,a={}){var p,g,_,m;const o=this,{tbody:i}=a,r=e.pessoa_dados,s=r.cpf?n.formatCPF(r.cpf):"",d=f(p=o,h,X).call(p,e);let l="";d?(l=f(g=o,h,I).call(g),e.idTrSelecionado=d.idTrSelecionado):l=f(_=o,h,Y).call(_);let c="N/C";return e.pessoa_perfil&&(c=e.pessoa_perfil.map(w=>w.perfil_tipo.nome).join(", ")),$(i).append(`
            <tr id=${e.idTr}>
                <td class="text-center text-nowrap">
                <div class="btn-group btnsAcao" role="group">
                        ${l}
                    </div>
                </td>
                <td class="text-nowrap text-truncate" style="max-width: 20rem" title="${r.nome}">${r.nome}</td>
                <td class="text-nowrap text-truncate" style="max-width: 20rem" title="${r.nome_social??""}">${r.nome_social??""}</td>
                <td class="text-center text-nowrap">${s}</td>
                <td class="text-center text-nowrap">${r.rg??""}</td>
                <td class="text-nowrap text-truncate" style="max-width: 20rem" title="${r.pai??""}">${r.pai??""}</td>
                <td class="text-nowrap text-truncate" style="max-width: 20rem" title="${r.mae??""}">${r.mae??""}</td>
                <td class="text-center text-nowrap ">${r.nascimento_data??""}</td>
                <td class="text-nowrap">${c}</td>
            </tr>
        `),f(m=o,h,we).call(m,e),e}async insertTableDataSelecionados(e,a={}){const o=this;let i=!1;switch(e.pessoa_dados_type){case window.Enums.PessoaTipoEnum.PESSOA_FISICA:i=await o.insertTableDataPessoaFisica(e,{tbody:$(`#tableData${o._objConfigs.sufixo}SelecionadosFisica tbody`)});break;case window.Enums.PessoaTipoEnum.PESSOA_JURIDICA:i=await o.insertTableDataPessoaJuridica(e,{tbody:$(`#tableData${o._objConfigs.sufixo}SelecionadosJuridica tbody`)});break}return i}}q=new WeakMap,B=new WeakMap,h=new WeakSet,ve=function(){const e=this,a=$(e._idModal),o=a.find(`#formDataSearch${e._objConfigs.sufixo}Fisica`),i=a.find(`#formDataSearch${e._objConfigs.sufixo}Juridica`),r=a.find(`#formDataSearch${e._objConfigs.sufixo}FisicaCriterios`),s=a.find(`#formDataSearch${e._objConfigs.sufixo}JuridicaCriterios`);if(!e._dataEnvModal.perfis_busca)return n.generateNotification("Perfis de busca não definidos.","warning"),!1;const d=e._dataEnvModal.perfis_busca.map(l=>l.id);o.find(".btnBuscar").on("click",function(l){l.preventDefault(),e._setTypeCurrentSearch=e._objConfigs.querys.consultaFiltrosFisica.name,e._generateQueryFilters({formDataSearch:e._objConfigs.querys.consultaFiltrosFisica.formDataSearch,appendData:{perfis_busca:d}})}).trigger("click"),i.find(".btnBuscar").on("click",function(l){l.preventDefault(),e._setTypeCurrentSearch=e._objConfigs.querys.consultaFiltrosJuridica.name,e._generateQueryFilters({formDataSearch:e._objConfigs.querys.consultaFiltrosJuridica.formDataSearch})}),r.find(".btnBuscar").on("click",async function(l){l.preventDefault(),e._setTypeCurrentSearch=e._objConfigs.querys.consultaFisicaCriterios.name;const c=await e.functionsCriteria.generateQueryFiltersCriteria();c&&await e._getData(c)}),s.find(".btnBuscar").on("click",async function(l){l.preventDefault(),e._setTypeCurrentSearch=e._objConfigs.querys.consultaJuridicaCriterios.name;const c=await e.functionsCriteria.generateQueryFiltersCriteria();c&&await e._getData(c)}),a.find(".btn-return").on("click",function(){e._promisseReturnValue.selecteds.length>0&&(e._promisseReturnValue.refresh=!0),e._setEndTimer=!0})},X=function(e){const a=this;for(const o of a._promisseReturnValue.selecteds)if(o.pessoa.id==e.id)return o.pessoa.idsTrs.push(e.idTr),o.pessoa;return null},we=function(e){const a=this;let o=JSON.parse(JSON.stringify(e));const i=async l=>{const c=g=>JSON.parse(JSON.stringify(g[0]));let p;if(l.pessoa_perfil.length>1){const g=a._dataEnvModal.perfis_busca.map(m=>m.id),_=l.pessoa_perfil.filter(m=>g.includes(m.perfil_tipo_id));if(_.length>1)try{const m=new Be;m.setDataEnvModal={perfis_opcoes:_},await a._modalHideShow(!1),p=(await m.modalOpen()).register,p.pessoa=l}catch(m){n.generateNotificationErrorCatch(m)}finally{await a._modalHideShow()}else p=c(_),p.pessoa=l}else p=c(l.pessoa_perfil),p.pessoa=l;return p},r=l=>{var g,_;const c=((_=(g=a._dataEnvModal)==null?void 0:g.attributes)==null?void 0:_.select)??{},p=a._promisseReturnValue;c!=null&&c.quantity&&c.quantity==1?p.selected=l:p.selecteds.push(l),p.refresh=!0,c!=null&&c.autoReturn&&c.autoReturn&&(c!=null&&c.quantity&&p.selecteds.length==c.quantity||c!=null&&c.quantity&&c.quantity==1&&p.selected)&&(a._setEndTimer=!0)},s=l=>{let c=JSON.parse(JSON.stringify(l));$(`#${c.idTr}`).find(".btn-select").on("click",async function(){var g,_,m,w;for(const y of Object.values(a._objConfigs.querys))if(y.recordsOnScreen){for(let P of y.recordsOnScreen)if(P=JSON.parse(JSON.stringify(P)),P.id==c.id){let G=await i(P),C=G.pessoa;const ae=f(g=a,h,X).call(g,G);if(ae)C.idTrSelecionado=ae.idTrSelecionado,$(`#${C.idTr}`).find(".btnsAcao").prepend(f(m=a,h,I).call(m));else{C.idTrSelecionado=j.generateUUID();const Fe=C.idTr;C.idTr=C.idTrSelecionado,await a.insertTableDataSelecionados(C),C.idTr=Fe,C.idsTrs=[C.idTr],r(G),$(`#${C.idTr}, #${C.idTrSelecionado}`).find(".btnsAcao").prepend(f(_=a,h,I).call(_))}$(`#${C.idTr}, #${C.idTrSelecionado}`).find(".btn-select").remove(),d(C)}}f(w=a,h,O).call(w)})},d=l=>{let c=JSON.parse(JSON.stringify(l));$(`#${c.idTrSelecionado}`).find(".btn-delete").off("click"),$(`#${c.idTr}, #${c.idTrSelecionado}`).find(".btn-delete").on("click",async function(){var _,m;const g=a._promisseReturnValue.selecteds.filter(w=>w.pessoa.idTrSelecionado==c.idTrSelecionado);a._promisseReturnValue.selecteds=a._promisseReturnValue.selecteds.filter(w=>w.pessoa.idTrSelecionado!=c.idTrSelecionado),$(`#${c.idTrSelecionado}`).remove(),$(`#${g[0].pessoa.idsTrs.join(", #")}`).find(".btn-delete").remove(),$(`#${g[0].pessoa.idsTrs.join(", #")}`).find(".btnsAcao").prepend(f(_=a,h,Y).call(_));for(const w of g[0].pessoa.idsTrs)$(`#${w}`).length&&(c.idTr=w,s({...c}));f(m=a,h,O).call(m)})};e.idTrSelecionado?d(o):s(o)},Y=function(){return'<button type="button" class="btn btn-success btn-sm btn-select" title="Selecionar"><i class="bi bi-check2-square"></i></button>'},I=function(){return'<button type="button" class="btn btn-danger btn-sm btn-delete" title="Remover"><i class="bi bi-trash"></i></button>'},O=function(){const e=this;$(e._idModal).find(".qtdRegistrosSelecionados").html(e._promisseReturnValue.selecteds.length)};var H,L,S,Ce,$e,ye,Pe,Ee;class He extends le{constructor(){super({idModal:"#modalServicoParticipacaoTipoTenant"});v(this,S);v(this,H,{formRegistros:!0,querys:{consultaFiltros:{name:"consulta-filtros",url:window.apiRoutes.baseServicoParticipacaoTipoTenant,urlSearch:`${window.apiRoutes.baseServicoParticipacaoTipoTenant}/consulta-filtros`}},sufixo:"ModalServicoParticipacaoTipoTenant"});v(this,L,{selecteds:[]});this._objConfigs=Object.assign(this._objConfigs,E(this,H)),this._promisseReturnValue=Object.assign(this._promisseReturnValue,E(this,L)),f(this,S,Ce).call(this)}async modalOpen(){const e=this;return await e._modalHideShow(),await e._modalOpen()}async insertTableData(e,a={}){var s,d,l;const o=this,{tbody:i}=a;let r=f(s=o,S,ye).call(s);return r+=f(d=o,S,$e).call(d),$(i).append(`
            <tr id="${e.idTr}" data-id="${e.id}">
                <td class="text-center">
                    <div class="btn-group btnsAcao" role="group">
                        ${r}
                    </div>
                </td>
                <td class="text-nowrap text-truncate" style="max-width: 20rem" title="${e.nome}">${e.nome}</td>
            </tr>
        `),f(l=o,S,Pe).call(l,e),!0}saveButtonAction(){var i;const e=this,a=$(e.getIdModal).find(".formRegistration");let o=n.getInputsValues(a[0]);f(i=e,S,Ee).call(i,o,a)&&e._save(o,e._objConfigs.querys.consultaFiltros.url)}}H=new WeakMap,L=new WeakMap,S=new WeakSet,Ce=function(){const e=this,a=$(e.getIdModal),o=a.find(`#formDataSearch${e._objConfigs.sufixo}`);a.find(".btn-new-register").on("click",async()=>{e._updateTitleRegistration("Novo Tipo de Participação")}),o.find(".btnBuscar").on("click",async i=>{i.preventDefault(),e._setTypeCurrentSearch=e._objConfigs.querys.consultaFiltros.name,await e._generateQueryFilters()}).trigger("click")},$e=function(){return'<button type="button" class="btn btn-outline-primary btn-sm btn-edit" title="Editar registro"><i class="bi bi-pencil"></i></button>'},ye=function(){var a,o;return(o=(a=this._dataEnvModal)==null?void 0:a.attributes)!=null&&o.select?'<button type="button" class="btn btn-outline-success btn-sm btn-select" title="Selecionar registro"><i class="bi bi-check-lg"></i></button>':""},Pe=function(e){const a=this;$(`#${e.idTr}`).find(".btn-edit").on("click",async function(){n.simulateLoading($(this));try{a._clearForm(),a._idRegister=e.id;const o=await a._getRecurse();if(o!=null&&o.data){a._action=W.PUT;const i=o.data;a._updateTitleRegistration(`Alterar: <b>${i.nome}</b>`);const r=$(a.getIdModal).find(".formRegistration");r.find('input[name="nome"]').val(i.nome),r.find('textarea[name="descricao"]').val(i.descricao),a._actionsHideShowRegistrationFields(!0),a._executeFocusElementOnModal(r.find('input[name="nome"]'))}}catch(o){n.generateNotificationErrorCatch(o)}finally{n.simulateLoading($(this),!1)}}),$(`#${e.idTr}`).find(".btn-select").on("click",async function(){var o,i;if((i=(o=a._dataEnvModal)==null?void 0:o.attributes)!=null&&i.select){const r=a._dataEnvModal.attributes.select,s=a._promisseReturnValue;(l=>{r!=null&&r.quantity&&r.quantity==1?s.selected=l:s.selecteds.push(l),s.refresh=!0,r!=null&&r.autoReturn&&r.autoReturn&&(r!=null&&r.quantity&&s.selecteds.length==r.quantity||r!=null&&r.quantity&&r.quantity==1&&s.selected)&&(a._setEndTimer=!0)})(e)}})},Ee=function(e,a){return n.verificationData(e.nome,{field:a.find('input[name="nome"]'),messageInvalid:"O nome do Tipo de Participação deve ser informado.",setFocus:!0})};var J,U,z,T,Te,Se,N,Re;class ne extends ce{constructor(){super({idModal:"#modalServicoParticipacaoParticipante"});v(this,T);v(this,J,{idRegister:void 0,pagamento_tipo_tenant_id:void 0});v(this,U,{url:{baseParticipacaoTipo:window.apiRoutes.baseServicoParticipacaoTipoTenant},sufixo:"ModalServicoParticipacaoParticipante",data:{porcentagem_livre:0}});v(this,z,{refresh:!1});this._objConfigs=Object.assign(this._objConfigs,E(this,U)),this._promisseReturnValue=Object.assign(this._promisseReturnValue,E(this,z)),this._dataEnvModal=Object.assign(this._dataEnvModal,E(this,J)),this._action=W.POST,f(this,T,Te).call(this)}async modalOpen(){var a,o;const e=this;return await n.loadingModalDisplay(!0,{message:"Carregando informações da participação..."}),e._dataEnvModal.dados_participacao.participacao_registro_tipo_id?(await f(a=e,T,N).call(a),await f(o=e,T,Se).call(o)?(await n.loadingModalDisplay(!1),await e._modalHideShow(),$(e.getIdModal).find('select[name="participacao_tipo_id"]').trigger("focus"),await e._modalOpen()):(await n.loadingModalDisplay(!1),await e._returnPromisseResolve())):(n.generateNotification("Tipo de registro de participação não informado.","error"),await e._returnPromisseResolve())}saveButtonAction(){var i;const e=this,a=$(e.getIdModal).find(".formRegistration");let o=n.getInputsValues(a[0]);f(i=e,T,Re).call(i,o)&&(e._promisseReturnValue.register=o,e._promisseReturnValue.refresh=!0,e._endTimer=!0)}}J=new WeakMap,U=new WeakMap,z=new WeakMap,T=new WeakSet,Te=function(){const e=this,a=$(e._idModal);a.find(".btnOpenModalTipoParticipacao").on("click",async function(){var d,l;const s=$(this);n.simulateLoading(s);try{const c=new He;c.setDataEnvModal={attributes:{select:{quantity:1,autoReturn:!0}}},await e._modalHideShow(!1);const p=await c.modalOpen();p.refresh&&(p.selected?f(d=e,T,N).call(d,p.selected.id):f(l=e,T,N).call(l))}catch(c){n.generateNotificationErrorCatch(c)}finally{n.simulateLoading(s,!1),await e._modalHideShow()}});const o=s=>{const d=/^(100|[0-9]{1,2}(,\d{0,2})?)$/;s.on("input",function(){d.test($(this).val())||$(this).val("")})},i=(s=!0)=>{s==!0?a.find(".divTextPorcentagemLivre, .btnAplicarRestante").show("fast"):a.find(".divTextPorcentagemLivre, .btnAplicarRestante").hide("fast")},r=a.find('input[name="valor"]');a.find('input[name="valor_tipo"]').on("click",async function(){r.off("input"),r.val(""),r.unmask(),$(this).val()=="porcentagem"?(o(r),i(!0)):(n.applyCustomNumberMask(r,{format:"#.##0,00",reverse:!0}),i(!1))}),o(r),a.find(".btnAplicarRestante").on("click",async function(){const s=e._objConfigs.data.porcentagem_livre;s==100?r.val(s):s>0&&r.val(n.formatWithCurrencyCommasOrFraction(s))})},Se=async function(){const e=this;try{const a=$(e.getIdModal),o=e._dataEnvModal.dados_participacao;let i="";switch(o.participacao_registro_tipo_id){case window.Enums.ParticipacaoRegistroTipoEnum.PERFIL:a.find(".lblTipoParticipante").html("Pessoa"),i=o.referencia.pessoa.pessoa_dados.nome;break;case window.Enums.ParticipacaoRegistroTipoEnum.GRUPO:a.find(".lblTipoParticipante").html("Grupo"),i=o.nome_grupo;break}const s=100-(e._dataEnvModal.porcentagem_ocupada??0),d=n.formatWithCurrencyCommasOrFraction(o.valor??0);return s?(a.find(".btnAplicarRestante").removeAttr("disabled"),e._objConfigs.data.porcentagem_livre=s):a.find(".btnAplicarRestante").attr("disabled",!0),a.find(".lblNome").html(i),a.find(".lblPorcentagemLivre").html(n.formatWithCurrencyCommasOrFraction(s)),a.find(`input[name="valor_tipo"][value="${o.valor_tipo??"porcentagem"}"]`).prop("checked",!0).trigger("click"),a.find('input[name="valor"]').val(d).trigger("input"),a.find('input[name="observacao"]').val(o.observacao??""),a.find('select[name="participacao_tipo_id"]').val(o.participacao_tipo_id??0),!0}catch(a){return n.generateNotificationErrorCatch(a),!1}},N=async function(e=null){const a=this;let o=e?{selectedIdOption:e}:{};const i=$(a.getIdModal).find('select[name="participacao_tipo_id"]');await n.fillSelect(i,a._objConfigs.url.baseParticipacaoTipo,o)},Re=function(e){const a=this,o=$(a.getIdModal).find(".formRegistration");let i=n.verificationData(e.participacao_tipo_id,{field:o.find('select[name="participacao_tipo_id"]'),messageInvalid:"O <b>tipo de participação</b> deve ser informado.",setFocus:!0});return e.valor=n.removeCommasFromCurrencyOrFraction(e.valor),e.valor>0?e.valor_tipo=="porcentagem"&&e.valor>a._objConfigs.data.porcentagem_livre&&(n.generateNotification("O <b>valor da participação</b> ultrapassa o valor da porcentagem livre.","warning"),i===!0&&a._executeFocusElementOnModal(o.find('input[name="valor"]')),i=!1):(n.generateNotification("O <b>valor da participação</b> deve ser informado.","warning"),i===!0&&a._executeFocusElementOnModal(o.find('input[name="valor"]')),i=!1),i};var b,xe,Z,Me,je,Ie,Oe,Ne,ee,De;class Ge{constructor(t,e){v(this,b);M(this,"_objConfigs");M(this,"_parentInstance");M(this,"_extraConfigs");this._objConfigs=e.objConfigs,this.parentInstance=t,this._extraConfigs=e.extraConfigs,f(this,b,xe).call(this)}async _inserirParticipanteNaTela(t){var _,m,w,y;const e=this,a=$(`#divParticipantes${e._objConfigs.sufixo}`);t.idCard=j.generateUUID();let o="",i="",r="",s="none";const d=f(_=e,b,Ie).call(_,t);switch(t.participacao_registro_tipo_id){case window.Enums.ParticipacaoRegistroTipoEnum.PERFIL:if(o=t.referencia.pessoa.pessoa_dados.nome,d)return n.generateNotification(`Participante <b>${o}</b> já foi inserido(a) para este tipo de participação.`,"error"),!1;break;case window.Enums.ParticipacaoRegistroTipoEnum.GRUPO:o=t.nome_grupo,d&&(n.generateNotification(`O Grupo <b>${o}</b> já foi inserido. O nome foi alterado para <b>${o} (Alterar)</b>.<br>Altere o nome do grupo posteriormente.`,"warning"),t.nome_grupo=`${o} (Alterar)`,o=t.nome_grupo),i+='<li><button type="button" class="dropdown-item fs-6 btn-add-pessoa">Inserir Pessoa</button></li>',i+='<li><button type="button" class="dropdown-item fs-6 btn-edit-name">Editar Nome</button></li>',r=f(m=e,b,Ne).call(m,t);break;default:return n.generateNotification("Tipo de registro de participação não informado.","error"),console.error("Tipo de registro de participação não informado.",t),!1}let l=t.participacao_tipo??null;if(!l)if(t.participacao_tipo_id){const P=await f(w=e,b,Z).call(w,t.participacao_tipo_id);P?l=P.data:l={nome:"Erro de busca"}}else return n.generateNotification("Tipo de participação não informado.","error"),console.error("Tipo de participação não informado.",t),!1;t.observacao&&(s="block");let c="",p=n.formatWithCurrencyCommasOrFraction(t.valor);switch(t.valor_tipo){case"porcentagem":c="Porcentagem",p+="%";break;case"valor_fixo":c="Valor Fixo",p=`R$ ${p}`;break;default:c="Erro valor tipo",console.error("Erro no tipo de valor",t);break}const g=`
            <div class="card-body">
                <h5 class="card-title d-flex align-items-center justify-content-between">
                    <span class="spanNome">${o}</span>
                    <div>
                        <div class="dropdown">
                            <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="bi bi-three-dots-vertical"></i>
                            </button>
                            <ul class="dropdown-menu">
                                ${i}
                                <li><button type="button" class="dropdown-item fs-6 btn-edit">Editar</button></li>
                                <li><button type="button" class="dropdown-item fs-6 btn-delete">Excluir</button></li>
                            </ul>
                        </div>
                    </div>
                </h5>
                <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-xl-4">
                    <div class="col">
                        <div class="form-text">Participação</div>
                        <label class="form-label text-truncate lblParticipacao">${l.nome}</label>
                    </div>
                    <div class="col">
                        <div class="form-text">Método</div>
                        <label class="form-label lblValorTipo">${c}</label>
                    </div>
                    <div class="col">
                        <div class="form-text">Valor</div>
                        <label class="form-label text-truncate lblValor">${p}</label>
                    </div>
                </div>
                <div class="row rowObservacao" style="display: ${s};">
                    <div class="col">
                        <div class="form-text">Observação</div>
                        <label class="form-label text-truncate lblObservacao" title="${t.observacao??""}">${t.observacao??""}</label>
                    </div>
                </div>
                ${r}
            </div>`;return e._objConfigs.data.participantesNaTela.push(t),a.append(`<div id="${t.idCard}" class="card">${g}</div>`),f(y=e,b,je).call(y,t),await e._atualizaPorcentagemLivre(t),t}async _atualizaPorcentagemLivre(){const t=this;let e=0,a=0;for(const i of t._objConfigs.data.participantesNaTela)i.valor_tipo=="porcentagem"?e+=i.valor:a+=i.valor;t._objConfigs.data.porcentagem_ocupada=e,t._objConfigs.data.valor_fixo=a;let o=0;e>0&&a>0?o=a+1:a>0&&(o=a),$(`#valor_fixo${t._objConfigs.sufixo}`).html(`${n.formatWithCurrencyCommasOrFraction(a)}`),$(`#porcentagem${t._objConfigs.sufixo}`).html(`${n.formatWithCurrencyCommasOrFraction(e)}`),$(`#valor_minimo${t._objConfigs.sufixo}`).html(`${n.formatWithCurrencyCommasOrFraction(o)}`),n.atualizarProgressBar($(`#progressBar${t._objConfigs.sufixo}`),e)}async _inserirIntegrante(t,e){var d,l;const a=this,o=$(`#accordionIntegrantes${t.idCard} .rowIntegrantes`);e.idCard=j.generateUUID();let i="",r="";switch(e.participacao_registro_tipo_id){case window.Enums.ParticipacaoRegistroTipoEnum.PERFIL:i=e.referencia.pessoa.pessoa_dados.nome,r=`Perfil ${e.referencia.perfil_tipo.nome}`;break;default:return n.generateNotification("Tipo de registro de participação não informado.","error"),console.error("Tipo de registro de participação não informado.",t),!1}o.append(`
            <div id="${e.idCard}" class="card">
                <div class="card-body">
                    <h5 class="card-title d-flex align-items-center justify-content-between">
                        <span>${i}</span>
                        <div>
                            <div class="d-grid gap-2 d-flex justify-content-end">
                                <button type="button" class="btn btn-outline-danger btn-sm btn-delete-integrante border-0">Excluir</button>
                            </div>
                        </div>
                    </h5>
                    <div class="row">
                        <div class="col">
                            <div class="form-text">Tipo Referência</div>
                            <label class="form-label">${r}</label>
                        </div>
                    </div>
                </div>
            </div>
            `);let s=a._objConfigs.data.participantesNaTela.find(c=>c.idCard==t.idCard);s.integrantes||(s.integrantes=[]),s.integrantes.push(e),f(d=a,b,ee).call(d,t.idCard),f(l=a,b,Oe).call(l,t,e)}async _buscarPresetParticipacaoTenant(t=null){const e=this;let a=t?{selectedIdOption:t}:{};const o=$(`#preset_id${e._objConfigs.sufixo}`);await n.fillSelect(o,e._objConfigs.url.baseParticipacaoPreset,a)}async _inserirParticipantesEIntegrantes(t){const e=this;$(`#divParticipantes${e._objConfigs.sufixo}`).html(""),e._objConfigs.data.participantesNaTela=[],e._atualizaPorcentagemLivre(),t.length?$(`#btnExcluirParticipante${e._objConfigs.sufixo}`).show("fast"):$(`#btnExcluirParticipante${e._objConfigs.sufixo}`).hide("fast"),await Promise.all(t.map(async a=>{const o=a.integrantes??[];delete a.integrantes;const i=await e._inserirParticipanteNaTela(a);await Promise.all(o.map(async r=>{await e._inserirIntegrante(i,r)}))}))}_saveVerificationsParticipantes(t){const e=this;let a=!0,o=e._objConfigs.data.porcentagem_ocupada;if((o>0&&o<100||o>100)&&(n.generateNotification(`As somas das porcentagens deve ser igual a 100%. Porcentagem informada ${n.formatWithCurrencyCommasOrFraction(o)}%.`,"warning"),a=!1),!t.participantes||t.participantes.length==0)n.generateNotification("E necessário informar pelo menos um participante.","warning"),a=!1;else for(const i of t.participantes)if(i.participacao_registro_tipo_id==window.Enums.ParticipacaoRegistroTipoEnum.GRUPO&&(!i.integrantes||i.integrantes.length==0)){n.generateNotification("E necessário informar pelo menos um integrante para participante do tipo Grupo.","warning"),a=!1;break}return a}}b=new WeakSet,xe=function(){var o;const t=this,e=async i=>{const r=new ne;r.setDataEnvModal={dados_participacao:i,porcentagem_ocupada:t._objConfigs.data.porcentagem_ocupada};const s=await r.modalOpen();s.refresh&&await t._inserirParticipanteNaTela(Object.assign(i,s.register))};switch($(`#btnInserirPessoa${t._objConfigs.sufixo}`).on("click",async function(){var r,s;const i=$(this);n.simulateLoading(i);try{const d={perfis_busca:window.Statics.PerfisPermitidoParticipacaoServico},l=new se({dataEnvModal:d});((r=t._extraConfigs)==null?void 0:r.typeParent)=="modal"&&await t.parentInstance._modalHideShow(!1);const c=await l.modalOpen();c.refresh&&c.selected&&await e({participacao_registro_tipo_id:window.Enums.ParticipacaoRegistroTipoEnum.PERFIL,referencia:c.selected,referencia_id:c.selected.id})}catch(d){n.generateNotificationErrorCatch(d)}finally{n.simulateLoading(i,!1),((s=t._extraConfigs)==null?void 0:s.typeParent)=="modal"&&await t.parentInstance._modalHideShow()}}),$(`#btnInserirGrupo${t._objConfigs.sufixo}`).on("click",async function(){var r,s;const i=$(this);n.simulateLoading(i);try{const d=new re;d.setDataEnvModal={title:"Novo grupo",mensagem:"Informe o nome do grupo"},((r=t._extraConfigs)==null?void 0:r.typeParent)=="modal"&&await t.parentInstance._modalHideShow(!1);const l=await d.modalOpen();l.refresh&&await e({participacao_registro_tipo_id:window.Enums.ParticipacaoRegistroTipoEnum.GRUPO,nome_grupo:l.name})}catch(d){n.generateNotificationErrorCatch(d)}finally{n.simulateLoading(i,!1),((s=t._extraConfigs)==null?void 0:s.typeParent)=="modal"&&await t.parentInstance._modalHideShow()}}),((o=t._extraConfigs)==null?void 0:o.modeParent)??"preset"){case"searchAndUse":$(`#preset_id${t._objConfigs.sufixo}`).on("change",async function(){var l,c;let i=!1;const r=$(this).val(),s=$(`#divParticipantes${t._objConfigs.sufixo}`),d=async p=>{var g,_;try{p&&((g=t._extraConfigs)==null?void 0:g.typeParent)=="modal"&&await t.parentInstance._modalHideShow(!1),await n.loadingModalDisplay(!0,{message:"Carregando informações do preset..."});const m=await ie.getRecurse({urlApi:t._objConfigs.url.baseParticipacaoPreset,idRegister:r});if(m.data){t._objConfigs.data.participantesNaTela=[],s.html(""),t._atualizaPorcentagemLivre();const w=m.data.participantes.map(y=>(delete y.id,delete y.parent_type,delete y.parent_id,y.integrantes=y.integrantes.map(P=>(delete P.id,delete P.parent_type,delete P.parent_id,P)),y));t._inserirParticipantesEIntegrantes(w)}}catch(m){n.generateNotificationErrorCatch(m)}finally{$(this).val(0),await n.loadingModalDisplay(!1),((_=t._extraConfigs)==null?void 0:_.typeParent)=="modal"&&await t.parentInstance._modalHideShow()}};if(j.isValidUUID(r))if(s.children().length>0)try{const p=new K;p.setDataEnvModal={title:"Inserção de Preset",message:"A inserção deste preset limpará todos os participantes atuais. Confirma esta ação?"},p.setFocusElementWhenClosingModal=$(this),((l=t._extraConfigs)==null?void 0:l.typeParent)=="modal"&&await t.parentInstance._modalHideShow(!1),(await p.modalOpen()).confirmResult&&(i=!0,await d(!1))}catch(p){n.generateNotificationErrorCatch(p)}finally{!i&&((c=t._extraConfigs)==null?void 0:c.typeParent)=="modal"&&await t.parentInstance._modalHideShow(!1)}else await d(!0);else r!="0"&&n.generateNotification("O ID do preset é inválido.","error")});break}},Z=async function(t){var a;const e=this;return await f(a=e,b,De).call(a,{idRegister:t,urlApi:e._objConfigs.url.baseParticipacaoTipo})},Me=async function(t){var r;const e=this;let a=t.participacao_tipo??null;if(!a||a&&a.id!=t.participacao_tipo_id)if(t.participacao_tipo_id){const s=await f(r=e,b,Z).call(r,t.participacao_tipo_id);s?a=s.data:a={nome:"Erro de busca"}}else return n.generateNotification("Tipo de participação não informado.","error"),console.error("Tipo de participação não informado.",t),!1;let o="",i=n.formatWithCurrencyCommasOrFraction(t.valor);switch(t.valor_tipo){case"porcentagem":o="Porcentagem",i+="%";break;case"valor_fixo":o="Valor Fixo",i=`R$ ${i}`;break;default:o="Erro valor tipo",console.error("Erro no tipo de valor",t);break}for(const s of e._objConfigs.data.participantesNaTela)if(s.idCard==t.idCard){s.participacao_tipo_id=t.participacao_tipo_id,s.valor_tipo=t.valor_tipo,s.valor=t.valor;break}$(`#${t.idCard} .lblParticipacao`).html(a.nome),$(`#${t.idCard} .lblValorTipo`).html(o),$(`#${t.idCard} .lblValor`).html(i),t.observacao?($(`#${t.idCard} .lblObservacao`).html(t.observacao),$(`#${t.idCard} .rowObservacao`).show("fast")):$(`#${t.idCard} .rowObservacao`).hide("fast"),await e._atualizaPorcentagemLivre()},je=async function(t){const e=this;$(`#${t.idCard} .btn-edit`).on("click",async function(){var o,i,r;const a=$(this);n.simulateLoading(a);try{let s=e._objConfigs.data.porcentagem_ocupada;t.valor_tipo=="porcentagem"&&(s-=t.valor);const d=new ne;d.setDataEnvModal={dados_participacao:t,porcentagem_ocupada:s},((o=e._extraConfigs)==null?void 0:o.typeParent)=="modal"&&await e.parentInstance._modalHideShow(!1);const l=await d.modalOpen();l.refresh&&await f(i=e,b,Me).call(i,Object.assign(t,l.register))}catch(s){n.generateNotificationErrorCatch(s)}finally{n.simulateLoading(a,!1),((r=e._extraConfigs)==null?void 0:r.typeParent)=="modal"&&await e.parentInstance._modalHideShow()}}),$(`#${t.idCard} .btn-delete`).on("click",async function(){var a,o;try{const i=new K;if(i.setDataEnvModal={title:"Remoção de Participante",message:"Tem certeza que deseja remover este participante?"},i.setFocusElementWhenClosingModal=$(this),((a=e._extraConfigs)==null?void 0:a.typeParent)=="modal"&&await e.parentInstance._modalHideShow(!1),(await i.modalOpen()).confirmResult){$(`#${t.idCard}`).remove();const s=e._objConfigs.data.participantesNaTela,d=s.findIndex(l=>l.idCard===t.idCard);d>-1&&s.splice(d,1),e._atualizaPorcentagemLivre(),n.generateNotification("Participante removido.","success")}}catch(i){n.generateNotificationErrorCatch(i)}finally{((o=e._extraConfigs)==null?void 0:o.typeParent)=="modal"&&await e.parentInstance._modalHideShow()}}),t.participacao_registro_tipo_id==window.Enums.ParticipacaoRegistroTipoEnum.GRUPO&&($(`#${t.idCard} .btn-edit-name`).on("click",async function(){var i,r;let a;for(const s of e._objConfigs.data.participantesNaTela)if(s.idCard==t.idCard){a=s;break}const o=$(this);n.simulateLoading(o);try{const s=new re;s.setDataEnvModal={title:"Novo grupo",mensagem:"Informe o nome do grupo",nome:a.nome_grupo},((i=e._extraConfigs)==null?void 0:i.typeParent)=="modal"&&await e.parentInstance._modalHideShow(!1);const d=await s.modalOpen();d.refresh&&(a.nome_grupo=d.name,$(`#${t.idCard} .spanNome`).html(a.nome_grupo))}catch(s){n.generateNotificationErrorCatch(s)}finally{n.simulateLoading(o,!1),((r=e._extraConfigs)==null?void 0:r.typeParent)=="modal"&&await e.parentInstance._modalHideShow()}}),$(`#${t.idCard} .btn-add-pessoa`).on("click",async function(){var o,i;const a=$(this);n.simulateLoading(a);try{const r=new se;r.setDataEnvModal={perfis_busca:window.Statics.PerfisPermitidoParticipacaoServico},((o=e._extraConfigs)==null?void 0:o.typeParent)=="modal"&&await e.parentInstance._modalHideShow(!1);const s=await r.modalOpen();s.refresh&&s.selecteds&&await Promise.all(s.selecteds.map(async d=>{await e._inserirIntegrante(t,{participacao_registro_tipo_id:window.Enums.ParticipacaoRegistroTipoEnum.PERFIL,referencia:d,referencia_id:d.id})}))}catch(r){n.generateNotificationErrorCatch(r)}finally{n.simulateLoading(a,!1),((i=e._extraConfigs)==null?void 0:i.typeParent)=="modal"&&await e.parentInstance._modalHideShow()}}))},Ie=function(t){const e=this;for(const a of e._objConfigs.data.participantesNaTela)if(a.participacao_registro_tipo_id==t.participacao_registro_tipo_id&&(a.participacao_tipo_id==t.participacao_tipo_id&&t.participacao_registro_tipo_id==window.Enums.ParticipacaoRegistroTipoEnum.PERFIL&&a.referencia.id==t.referencia.id||t.participacao_registro_tipo_id==window.Enums.ParticipacaoRegistroTipoEnum.GRUPO&&a.nome_grupo==t.nome_grupo))return a;return null},Oe=async function(t,e){const a=this;$(`#${e.idCard} .btn-delete-integrante`).on("click",async function(){var o,i,r;try{const s=new K;if(s.setDataEnvModal={title:"Remoção de Integrante",message:"Tem certeza que deseja remover este integrante?"},s.setFocusElementWhenClosingModal=$(this),((o=a._extraConfigs)==null?void 0:o.typeParent)=="modal"&&await a.parentInstance._modalHideShow(!1),(await s.modalOpen()).confirmResult){$(`#${e.idCard}`).remove();const l=a._objConfigs.data.participantesNaTela,c=l.findIndex(p=>p.idCard===t.idCard);if(c>-1){const p=l[c].integrantes.findIndex(g=>g.idCard===e.idCard);p>-1&&l[c].integrantes.splice(p,1)}f(i=a,b,ee).call(i,t.idCard),n.generateNotification("Integrante removido.","success")}}catch(s){n.generateNotificationErrorCatch(s)}finally{((r=a._extraConfigs)==null?void 0:r.typeParent)=="modal"&&await a.parentInstance._modalHideShow()}})},Ne=function(t){return`
            <div class="accordion mt-2" id="accordionIntegrantes${t.idCard}">
                <div class="accordion-item">
                    <div class="accordion-header">
                        <button class="accordion-button py-1 collapsed" type="button" data-bs-toggle="collapse"
                            data-bs-target="#collapseOne${t.idCard}" aria-expanded="true"
                            aria-controls="collapseOne${t.idCard}">
                            <span class="qtdIntegrantes">Nenhum integrante no grupo</span>
                        </button>
                    </div>
                    <div id="collapseOne${t.idCard}" class="accordion-collapse collapse"
                        data-bs-parent="#accordionIntegrantes${t.idCard}">
                        <div class="accordion-body">
                            <div class="row rowIntegrantes row-cols-1 g-2"></div>
                        </div>
                    </div>
                </div>
            </div>
        `},ee=function(t){const o=this._objConfigs.data.participantesNaTela.find(s=>s.idCard==t).integrantes.length,i=$(`#accordionIntegrantes${t} .qtdIntegrantes`);let r="Nenhum integrante no grupo";o===1?r="1 integrante no grupo":o>1&&(r=`${o} integrantes no grupo`),i.html(r)},De=async function(t={}){const e=this,{idRegister:a=e._idRegister,urlApi:o=e._objConfigs.url.base}=t;try{return ie.getRecurse({urlApi:o,idRegister:a})}catch(i){return n.generateNotificationErrorCatch(i),!1}};export{ie as R,Ge as S,He as m};
